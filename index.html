var widget = new cp.CloudPayments();

widget.charge(
    {
        publicId: 'pk_371ac53e43d82e5215af37c4dda28',
        description: 'Оплата тарифа PRO',
        amount: 100,
        currency: 'RUB',
        data: {
            telegram_id: user.id,
            username: user.username,
            tariff: 'pro'
        }
    },
    function (options) {
        // ✅ УСПЕХ (БЕЗ REDIRECT)
        fetch('https://nikabogdanovaa98798.app.n8n.cloud/webhook/payment-result', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                status: 'success',
                payment: options
            })
        });

        tg.showAlert('✅ Оплата прошла успешно');
        tg.close();
    },
    function (reason, options) {
        // ❌ ОШИБКА / ОТМЕНА
        fetch('https://nikabogdanovaa98798.app.n8n.cloud/webhook/payment-result', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                status: 'fail',
                reason: reason,
                payment: options
            })
        });

        tg.showAlert('❌ Оплата не прошла');
    }
);
